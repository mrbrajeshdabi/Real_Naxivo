<!DOCTYPE html>
<html lang="en" oncontextmenu="alert(`Please Stop Now ...`); return false;">
<head>
  <title>Naxivo</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="shortcut icon" href="assets/images/logo.jpeg" type="image/x-icon">
  <script src="assets/js/socket.io.js"></script>
</head>
<body class="body">

<audio id="caller" hidden></audio>
    <div class="row p-0 m-0">
       <center><div class="callnow"></div></center>
        <div class="col-md-2 p-0 m-0 bg-dark">
            <div class="laptop-responsive">
                <div class="card bg-dark text-light">
                    <div class="card-header">
                        <div class="card-title text-danger">Naxivo</div>
                    </div>
                    <div class="card-body">
                        <div class="profilebox d-flex justify-content-center align-items-center flex-column animate__animated animate__fadeIn"></div>
                    </div>
                    <div class="card-footer">
                        <ul class="list-group bg-dark">
                            <li class="list-group-item bg-dark text-light animate__animated animate__fadeInLeft" pageid="chating" id="chat"><button class="btn btn-light" type="button"></button><span class="ms-5">Chating</span></li>
                            <li class="list-group-item bg-secondary text-light animate__animated animate__fadeInLeft menu" pageid="friendsnoti"><button class="btn btn-light" type="button"></button><span class="ms-5">Friends</span></li>
                            <li class="list-group-item bg-secondary text-light animate__animated animate__fadeInLeft menu" pageid="calling"><button class="btn btn-light" type="button"></button><span class="ms-5">Calling</span></li>
                            <li class="list-group-item bg-secondary text-light animate__animated animate__fadeInLeft menu" pageid="" id="logout"><button class="btn btn-light" type="button"></button><span class="ms-5">Logout</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- laptop end -->

            <!-- mobile responsive -->

            <div class="mobile-responsive">
                <div class="card bg-dark text-light">
                    <div class="card-header">
                        <div class="card-title text-danger">Naxivo</div>
                    </div>
                    <div class="card-body">
                        <div class="profilebox d-flex justify-content-center align-items-center flex-column animate__animated animate__fadeIn"></div>
                    </div>
                    <div class="card-footer">
                        <ul class="list-group bg-dark">
                            <div class="d-flex justify-content-center align-items-center">
                            <li class="list-group-item bg-dark text-light " pageid="chating" id="chats"><button class="btn btn-light" type="button"><i class="fa fa-commenting"></i></button></li>
                            <li class="list-group-item bg-dark text-light menu"   pageid="friendsnoti" id="borderli"><button class="btn btn-light" type="button"><i class="fa fa-users"></i></button></li>
                            <li class="list-group-item bg-dark text-light menu"   pageid="calling" id="borderli"><button class="btn btn-light" type="button"><i class="fa fa-phone-square"></i></button></li>
                            <li class="list-group-item bg-dark text-light" id="mobilelogout"><button class="btn btn-light" type="button"><i class="fa-solid fa-arrow-right-from-bracket"></i></button></li>
                            </div>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- end mobile -->


        </div>
        <div class="col-md-10 p-0 m-0 animate__animated animate__fadeIn" id="storepage">
            <!-- <div class="dgraph"></div> --->
        </div>
    </div>

</body>
</html>
<script src="assets/js/auth.js"></script>
<script src="assets/js/newworker.js"></script>
<script src="assets/js/updatedata.js"></script>
<script src="assets/js/io.js"></script>
<script>
    if(sessionStorage.getItem("user") == null)
    {
        window.location.href = "index.html";   
    }
    document.querySelector("#logout").addEventListener("click",()=>{
        let logout = sessionStorage.removeItem("user");
        if(logout == undefined)
        {
            window.location.href="index.html";   
        }
    })
    $("#mobilelogout").click(function(){
        let mlog = sessionStorage.removeItem("user");
        if(mlog == undefined)
        {
            window.location.href="index.html";   
        }
    })

    //chating clicked
    $("#chat").click(function(){
        window.location.href="assets/pages/chating.html";
    })
    $("#chats").click(function(){
        window.location.href="assets/pages/chating.html";
    })
</script>


<!-- The Modal -->
<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header bg-dark">
        <h4 class="modal-title">Update Profile <i class="fa fa-user-circle"></i></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body bg-dark">
        <form class="update_frm p-5" enctype="multipart/form-data">
                <input type="hidden" name="uid" id="uid">
                <div class="form-group mb-3">
                    <label for="profilepic">profilepic</label>
                    <input type="file" class="form-control" id="profilepic" name="profilepic" accept="image/*">
                </div>
                <div class="form-group mb-1">
                    <label for="fname">FullName</label>
                    <input type="text" class="form-control  text-light" id="fname" name="fname">
                </div>
                <div class="form-group mb-1">
                    <label for="email">Email</label>
                    <input type="text" class="form-control text-light" id="email" name="email" disabled placeholder="Email Not Updated">
                </div>
                <div class="form-group mb-1">
                    <label for="phone">Mobile</label>
                    <input type="number" class="form-control  text-light" id="phone" name="phone">
                </div>
                <button class="btn btn-outline-primary mt-3 mb-1 w-50" type="submit" id="updatein">UpdateIn</button>
             </form>
      </div>

    </div>
  </div>
</div>
<!-- end update info modal -->


<!-- calling main profile  -->
        <!-- The Modal -->
  <div class="modal fade" id="myvideos">
    <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header bg-dark text-danger">
        <h4 class="modal-title" id="callingnames"></h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <!-- Modal body -->
      <div class="modal-body bg-dark">
        <div class="d-flex videocall" id="hiddenvideobox">

            <div class="outgoingbox border">
                <video id="outgoingvideo" autoplay></video>
            </div>
            <div class="incomingbox border">
                <video id="incomingvideo" autoplay></video>
            </div>

        </div>

        <!-- audio calling  -->
         <div class="voicecall border">
                <div class="incomingcall d-flex justify-content-center align-items-center flex-column">
                    <img src="assets/images/man-user-circle-black-icon.png" class="img-fluid img-thumbnail rounded ms-2"  id="profilepicmain">
                    <span class="mt-2 mb-2" id="callingsnameaudio"></span>
                    <span class="mt-2 mb-2 " id="callingrnameaudio"></span>
                    <b class="mt-2 rtiming"></b>
                    <b class="mt-2 stiming"></b>
                </div>
                <div class="voicetool d-flex justify-content-center align-items-center mt-2">
                    <button class="btn btn-info me-5 animate__animated animate__pulse animate__infinite " type="button" id="muteandunmuteaudio"><i class="fa fa-microphone-slash"></i></button>
                    <button class="btn btn-danger ms-5 animate__animated animate__pulse animate__infinite " type="button" id="rejectcall"><i class="fa fa-phone"></i></button>
                </div>
             </div>

      </div>
      <!-- Modal footer -->
      <div class="modal-footer bg-dark">
         <div class="videotool d-none">
            <button class="btn btn-info ms-3 " type="button" id="muteandunmutevideo"><i class="fa fa-microphone-slash"></i></button>
            <button class="btn btn-danger ms-1 " type="button" id="rejectvideocall"><i class="fa fa-phone"></i></button>
            <button class="btn btn-info ms-1 " type="button" id="videoonoff"><i class="fas fa-video-slash"></i></button>
        </div>
      </div>

    </div>
  </div>
        </div>
<!-- end modal -->

<script>
    //io.js not working

// stop camara 
$("#videoonoff").click(function(){
    let from = $(this).attr("from");
    let to = $(this).attr("to");
    if($("#outgoingvideo")[0].hidden == false)
    {
        $("#outgoingvideo")[0].play();
        $("#outgoingvideo").prop('hidden', true);
        $("#videoonoff").html(`<i class="fas fa-video"></i>`);
        socket.emit("close-vcall",{from,to});
        //to wali id meri from uski  caalling ki wajah se chaange he id
        //console.log($("#outgoingvideo").get(0).hidden);
    } 
    else
    {
        $("#outgoingvideo")[0].play();
        $("#outgoingvideo").prop('hidden', false);
        $("#videoonoff").html(`<i class="fas fa-video-slash"></i>`);
        socket.emit("open-vcall",{from,to});
        //console.log($("#outgoingvideo").get(0).hidden);
    } 
})
// muted video
$("#muteandunmutevideo").click(function(){
    //$("#outgoingvideo").get(0).pause();
    let from = $(this).attr("from");
    let to =  $(this).attr("to");
    if($("#outgoingvideo")[0].muted == false)
    {
        $("#muteandunmutevideo").html("<i class='fa fa-microphone'></i>")
        $("#outgoingvideo").prop('muted', true);
        socket.emit("muted",{from,to});
    }
    else
    {
        $("#muteandunmutevideo").html("<i class='fa fa-microphone-slash'></i>")
        $("#outgoingvideo").prop('muted', false);
    }
    //localstreaam.getTracks()[1].muted = true;
})

$("#muteandunmuteaudio").click(function(){
    //$("#outgoingvideo").get(0).pause();
    let from = $(this).attr("from");
    let to =  $(this).attr("to");
    if($("#outgoingvideo")[0].muted == false)
    {
        $("#muteandunmuteaudio").html("<i class='fa fa-microphone'></i>")
        $("#outgoingvideo").prop('muted', true);
        socket.emit("muted",{from,to});
    }
    else
    {
        $("#muteandunmuteaudio").html("<i class='fa fa-microphone-slash'></i>")
        $("#outgoingvideo").prop('muted', false);
    }
    //localstreaam.getTracks()[1].muted = true;
})
    
$("#rejectcall").click(function(){
        let from = $(this).attr("from");
        let to =  $(this).attr("to");
        socket.emit("end-call",{from,to});
    })
//reject videocall
$("#rejectvideocall").click(function(){
    let from = $(this).attr("from");
    let to =  $(this).attr("to");
    socket.emit("end-call",{from,to});
});
//disconnect call
$("#cancelaudiocall").click(function(){
    let from = $(this).attr("from");
    let to =  $(this).attr("to");
    console.log(from,to);
    socket.emit("end-call",{from,to});
})
    // secure page
    document.onkeydown=function(key){
        if(key.ctrlKey && key.keyCode == 85)
        {
            alert("stop");
            return false; 
        }
       else if(key.ctrlKey && key.keyCode == 16 && key.keyCode == 73)
        {
            alert("stop");
            return false;
        }
    }
</script>
  



